// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = "postgresql://postgres:root@localhost:5432/Reportes_db?schema=public"
}

enum EstadoReporte {
  SinRevisar
  EnProceso
  Revisado
}

model Reporte {
  id                      Int           @id @default(autoincrement())
  numero_registro         String        @unique // Código o correlativo del reporte
  tipo_documento          String        // DNI, Pasaporte, etc.
  numero_documento        String        // Número del documento
  sede                    String        // Sede (ej: "CFP HUANCAYO")
  tipo_reporte            String        // Acto Subestándar, Condición Subestándar, etc.
  lugar_incidente         String        // Ubicación específica donde ocurrió
  descripcion_observacion String        // Descripción detallada del incidente
  acciones_tomadas        String?       // Acciones tomadas al momento (opcional)
  estado                  EstadoReporte @default(SinRevisar)
  fecha_registro          DateTime      @default(now())
  fecha_inicio            DateTime?     // Fecha cuando se almacena la primera evidencia
  fecha_fin               DateTime?     // Fecha cuando se marca como "Revisado"
  
  // Relaciones
  evidencias              Evidence[]
  acciones               Accion[]
  
  @@map("Reporte")
}

model Accion {
  id          Int      @id @default(autoincrement())
  descripcion String
  reporteId   Int
  
  // Relaciones
  reporte    Reporte     @relation(fields: [reporteId], references: [id], onDelete: Cascade)
  evidencias Evidence[]
  
  @@map("Accion")
}

model Evidence {
  id        Int      @id @default(autoincrement())
  url       String
  reporteId Int?
  accionId  Int?
  
  // Relaciones
  reporte Reporte? @relation(fields: [reporteId], references: [id], onDelete: Cascade)
  accion  Accion?  @relation(fields: [accionId], references: [id], onDelete: Cascade)
  
  @@map("Evidence")
}

model Profesor {
  id                Int      @id @default(autoincrement())
  nombre_completo    String
  correo            String   @unique
  area              String?
  cargo             String?
  activo            Boolean  @default(true)
  fecha_registro    DateTime @default(now())
  fecha_actualizacion DateTime @updatedAt
  
  @@map("Profesor")
}